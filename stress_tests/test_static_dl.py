import multiprocessing

import requests
import sys

import time

import shutil

BASE_PHOTO_URL_TORNADO = "http://localhost:9999/originals/2016-04-09-tenerife"
BASE_PHOTO_URL_DJANGO = "http://localhost:8000/originals/2016-04-09-tenerife"

filenames = ['DSC04405.JPG', 'DSC04406.JPG', 'DSC04407.JPG', 'DSC04408.JPG', 'DSC04409.JPG', 'DSC04410.JPG', 'DSC04411.JPG', 'DSC04412.JPG', 'DSC04413.JPG', 'DSC04414.JPG', 'DSC04415.JPG', 'DSC04416.JPG', 'DSC04417.JPG', 'DSC04418.JPG', 'DSC04419.JPG', 'DSC04420.JPG', 'DSC04421.JPG', 'DSC04422.JPG', 'DSC04423.JPG', 'DSC04424.JPG', 'DSC04425.JPG', 'DSC04426.JPG', 'DSC04427.JPG', 'DSC04428.JPG', 'DSC04429.JPG', 'DSC04430.JPG', 'DSC04431.JPG', 'DSC04432.JPG', 'DSC04433.JPG', 'DSC04434.JPG', 'DSC04436.JPG', 'DSC04437.JPG', 'DSC04438.JPG', 'DSC04439.JPG', 'DSC04440.JPG', 'DSC04441.JPG', 'DSC04442.JPG', 'DSC04443.JPG', 'DSC04444.JPG', 'DSC04445.JPG', 'DSC04446.JPG', 'DSC04447.JPG', 'DSC04448.JPG', 'DSC04449.JPG', 'DSC04450.JPG', 'DSC04451.JPG', 'DSC04452.JPG', 'DSC04453.JPG', 'DSC04455.JPG', 'DSC04456.JPG', 'DSC04457.JPG', 'DSC04458.JPG', 'DSC04459.JPG', 'DSC04460.JPG', 'DSC04462.JPG', 'DSC04463.JPG', 'DSC04464.JPG', 'DSC04465.JPG', 'DSC04466.JPG', 'DSC04467.JPG', 'DSC04468.JPG', 'DSC04469.JPG', 'DSC04470.JPG', 'DSC04471.JPG', 'DSC04472.JPG', 'DSC04473.JPG', 'DSC04474.JPG', 'DSC04475.JPG', 'DSC04476.JPG', 'DSC04477.JPG', 'DSC04478.JPG', 'DSC04479.JPG', 'DSC04480.JPG', 'DSC04481.JPG', 'DSC04482.JPG', 'DSC04483.JPG', 'DSC04484.JPG', 'DSC04485.JPG', 'DSC04486.JPG', 'DSC04487.JPG', 'DSC04488.JPG', 'DSC04489.JPG', 'DSC04490.JPG', 'DSC04491.JPG', 'DSC04492.JPG', 'DSC04493.JPG', 'DSC04494.JPG', 'DSC04495.JPG', 'DSC04496.JPG', 'DSC04497.JPG', 'DSC04498.JPG', 'DSC04500.JPG', 'DSC04501.JPG', 'DSC04502.JPG', 'DSC04503.JPG', 'DSC04504.JPG', 'DSC04505.JPG', 'DSC04506.JPG', 'DSC04507.JPG', 'DSC04508.JPG', 'DSC04509.JPG', 'DSC04510.JPG', 'DSC04511.JPG', 'DSC04512.JPG', 'DSC04513.JPG', 'DSC04514.JPG', 'DSC04515.JPG', 'DSC04517.JPG', 'DSC04518.JPG', 'DSC04519.JPG', 'DSC04520.JPG', 'DSC04521.JPG', 'DSC04522.JPG', 'DSC04523.JPG', 'DSC04524.JPG', 'DSC04525.JPG', 'DSC04526.JPG', 'DSC04527.JPG', 'DSC04528.JPG', 'DSC04529.JPG', 'DSC04530.JPG', 'DSC04531.JPG', 'DSC04532.JPG', 'DSC04533.JPG', 'DSC04534.JPG', 'DSC04535.JPG', 'DSC04536.JPG', 'DSC04537.JPG', 'DSC04538.JPG', 'DSC04539.JPG', 'DSC04540.JPG', 'DSC04541.JPG', 'DSC04542.JPG', 'DSC04543.JPG', 'DSC04544.JPG', 'DSC04545.JPG', 'DSC04546.JPG', 'DSC04547.JPG', 'DSC04548.JPG', 'DSC04549.JPG', 'DSC04550.JPG', 'DSC04551.JPG', 'DSC04552.JPG', 'DSC04555.JPG', 'DSC04556.JPG', 'DSC04557.JPG', 'DSC04558.JPG', 'DSC04559.JPG', 'DSC04560.JPG', 'DSC04561.JPG', 'DSC04562.JPG', 'DSC04563.JPG', 'DSC04564.JPG', 'DSC04565.JPG', 'DSC04566.JPG', 'DSC04567.JPG', 'DSC04568.JPG', 'DSC04569.JPG', 'DSC04570.JPG', 'DSC04571.JPG', 'DSC04572.JPG', 'DSC04573.JPG', 'DSC04574.JPG', 'DSC04575.JPG', 'DSC04576.JPG', 'DSC04577.JPG', 'DSC04578.JPG', 'DSC04579.JPG', 'DSC04580.JPG', 'DSC04581.JPG', 'DSC04582.JPG', 'DSC04583.JPG', 'DSC04584.JPG', 'DSC04585.JPG', 'DSC04586.JPG', 'DSC04587.JPG', 'DSC04588.JPG', 'DSC04589.JPG', 'DSC04590.JPG', 'DSC04591.JPG', 'DSC04592.JPG', 'DSC04593.JPG', 'DSC04594.JPG', 'DSC04595.JPG', 'DSC04596.JPG', 'DSC04597.JPG', 'DSC04598.JPG', 'DSC04599.JPG', 'DSC04600.JPG', 'DSC04601.JPG', 'DSC04602.JPG', 'DSC04603.JPG', 'DSC04604.JPG', 'DSC04605.JPG', 'DSC04606.JPG', 'DSC04607.JPG', 'DSC04608.JPG', 'DSC04609.JPG', 'DSC04610.JPG', 'DSC04611.JPG', 'DSC04612.JPG', 'DSC04613.JPG', 'DSC04614.JPG', 'DSC04615.JPG', 'DSC04616.JPG', 'DSC04617.JPG', 'DSC04618.JPG', 'DSC04619.JPG', 'DSC04620.JPG', 'DSC04621.JPG', 'DSC04622.JPG', 'DSC04623.JPG', 'DSC04624.JPG', 'DSC04625.JPG', 'DSC04626.JPG', 'DSC04627.JPG', 'DSC04628.JPG', 'DSC04629.JPG', 'DSC04630.JPG', 'DSC04631.JPG', 'DSC04632.JPG', 'DSC04633.JPG', 'DSC04634.JPG', 'DSC04635.JPG', 'DSC04636.JPG', 'DSC04637.JPG', 'DSC04638.JPG', 'DSC04639.JPG', 'DSC04640.JPG', 'DSC04641.JPG', 'DSC04642.JPG', 'DSC04643.JPG', 'DSC04644.JPG', 'DSC04645.JPG', 'DSC04646.JPG', 'DSC04647.JPG', 'DSC04648.JPG', 'DSC04649.JPG', 'DSC04650.JPG', 'DSC04651.JPG', 'DSC04652.JPG', 'DSC04653.JPG', 'DSC04654.JPG', 'DSC04655.JPG', 'DSC04656.JPG', 'DSC04657.JPG', 'DSC04658.JPG', 'DSC04659.JPG', 'DSC04660.JPG', 'DSC04661.JPG', 'DSC04662.JPG', 'DSC04663.JPG', 'DSC04664.JPG', 'DSC04665.JPG', 'DSC04666.JPG', 'DSC04667.JPG', 'DSC04668.JPG', 'DSC04669.JPG', 'DSC04670.JPG', 'DSC04671.JPG', 'DSC04672.JPG', 'DSC04673.JPG', 'DSC04675.JPG', 'DSC04676.JPG', 'DSC04677.JPG', 'DSC04678.JPG', 'DSC04679.JPG', 'DSC04680.JPG', 'DSC04681.JPG', 'DSC04682.JPG', 'DSC04683.JPG', 'DSC04684.JPG', 'DSC04685.JPG', 'DSC04686.JPG', 'DSC04687.JPG', 'DSC04688.JPG', 'DSC04689.JPG', 'DSC04690.JPG', 'DSC04691.JPG', 'DSC04692.JPG', 'DSC04693.JPG', 'DSC04694.JPG', 'DSC04695.JPG', 'DSC04696.JPG', 'DSC04697.JPG', 'DSC04698.JPG', 'DSC04699.JPG', 'DSC04700.JPG', 'DSC04701.JPG', 'DSC04702.JPG', 'DSC04703.JPG', 'DSC04704.JPG', 'DSC04705.JPG', 'DSC04706.JPG', 'DSC04707.JPG', 'DSC04708.JPG', 'DSC04709.JPG', 'DSC04710.JPG', 'DSC04711.JPG', 'DSC04712.JPG', 'DSC04713.JPG', 'DSC04714.JPG', 'DSC04715.JPG', 'DSC04716.JPG', 'DSC04717.JPG', 'DSC04718.JPG', 'DSC04719.JPG', 'DSC04720.JPG', 'DSC04721.JPG', 'DSC04722.JPG', 'DSC04723.JPG', 'DSC04724.JPG', 'DSC04725.JPG', 'DSC04726.JPG', 'DSC04727.JPG', 'DSC04728.JPG', 'DSC04729.JPG', 'DSC04730.JPG', 'DSC04731.JPG', 'DSC04732.JPG', 'DSC04733.JPG', 'DSC04735.JPG', 'DSC04736.JPG', 'DSC04737.JPG', 'DSC04738.JPG', 'DSC04739.JPG', 'DSC04740.JPG', 'DSC04741.JPG', 'DSC04742.JPG', 'DSC04743.JPG', 'DSC04744.JPG', 'DSC04745.JPG', 'DSC04746.JPG', 'DSC04747.JPG', 'DSC04748.JPG', 'DSC04749.JPG', 'DSC04750.JPG', 'DSC04751.JPG', 'DSC04752.JPG', 'DSC04753.JPG', 'DSC04754.JPG', 'DSC04756.JPG', 'DSC04757.JPG', 'DSC04758.JPG', 'DSC04759.JPG', 'DSC04760.JPG', 'DSC04761.JPG', 'DSC04762.JPG', 'DSC04763.JPG', 'DSC04764.JPG', 'DSC04765.JPG', 'DSC04766.JPG', 'DSC04767.JPG', 'DSC04768.JPG', 'DSC04769.JPG', 'DSC04770.JPG', 'DSC04771.JPG', 'DSC04772.JPG', 'DSC04773.JPG', 'DSC04774.JPG', 'DSC04775.JPG', 'DSC04776.JPG', 'DSC04777.JPG', 'DSC04778.JPG', 'DSC04779.JPG', 'DSC04780.JPG', 'DSC04781.JPG', 'DSC04782.JPG', 'DSC04783.JPG', 'DSC04784.JPG', 'DSC04785.JPG', 'DSC04786.JPG', 'DSC04787.JPG', 'DSC04788.JPG', 'DSC04789.JPG', 'DSC04790.JPG', 'DSC04791.JPG', 'DSC04792.JPG', 'DSC04793.JPG', 'DSC04794.JPG', 'DSC04795.JPG', 'DSC04796.JPG', 'DSC04797.JPG', 'DSC04798.JPG', 'DSC04799.JPG', 'DSC04800.JPG', 'DSC04801.JPG', 'DSC04802.JPG', 'DSC04803.JPG', 'DSC04804.JPG', 'DSC04805.JPG', 'DSC04806.JPG', 'DSC04807.JPG', 'DSC04808.JPG', 'DSC04809.JPG', 'DSC04810.JPG', 'DSC04811.JPG', 'DSC04812.JPG', 'DSC04813.JPG', 'DSC04814.JPG', 'DSC04815.JPG', 'DSC04816.JPG', 'DSC04817.JPG', 'DSC04818.JPG', 'DSC04819.JPG', 'DSC04820.JPG', 'DSC04821.JPG', 'DSC04822.JPG', 'DSC04823.JPG', 'DSC04824.JPG', 'DSC04825.JPG', 'DSC04826.JPG', 'DSC04827.JPG', 'DSC04828.JPG', 'DSC04829.JPG', 'DSC04830.JPG', 'DSC04831.JPG', 'DSC04832.JPG', 'DSC04833.JPG', 'DSC04834.JPG', 'DSC04835.JPG', 'DSC04836.JPG', 'DSC04837.JPG', 'DSC04838.JPG', 'DSC04839.JPG', 'DSC04841.JPG', 'DSC04842.JPG', 'DSC04843.JPG', 'DSC04844.JPG', 'DSC04845.JPG', 'DSC04846.JPG', 'DSC04847.JPG', 'DSC04850.JPG', 'DSC04851.JPG', 'DSC04852.JPG', 'DSC04853.JPG', 'DSC04854.JPG', 'DSC04855.JPG', 'DSC04856.JPG', 'DSC04857.JPG', 'DSC04858.JPG', 'DSC04859.JPG', 'DSC04860.JPG', 'DSC04861.JPG', 'DSC04862.JPG', 'DSC04863.JPG', 'DSC04864.JPG', 'DSC04865.JPG', 'DSC04866.JPG', 'DSC04867.JPG', 'DSC04868.JPG', 'DSC04869.JPG', 'DSC04870.JPG', 'DSC04871.JPG', 'DSC04872.JPG', 'DSC04873.JPG', 'DSC04874.JPG', 'DSC04875.JPG', 'DSC04876.JPG', 'DSC04877.JPG', 'DSC04878.JPG', 'DSC04879.JPG', 'DSC04880.JPG', 'DSC04881.JPG', 'DSC04882.JPG', 'DSC04883.JPG', 'DSC04884.JPG', 'DSC04885.JPG', 'DSC04886.JPG', 'DSC04887.JPG', 'DSC04888.JPG', 'DSC04889.JPG', 'DSC04890.JPG', 'DSC04891.JPG', 'DSC04892.JPG', 'DSC04893.JPG', 'DSC04894.JPG', 'DSC04895.JPG', 'DSC04896.JPG', 'DSC04897.JPG', 'DSC04899.JPG', 'DSC04900.JPG', 'DSC04902.JPG', 'DSC04903.JPG', 'DSC04904.JPG', 'DSC04905.JPG', 'DSC04906.JPG', 'DSC04907.JPG', 'DSC04908.JPG', 'DSC04909.JPG', 'DSC04910.JPG', 'DSC04911.JPG', 'DSC04912.JPG', 'DSC04913.JPG', 'DSC04914.JPG', 'DSC04916.JPG', 'DSC04917.JPG', 'DSC04918.JPG', 'DSC04920.JPG', 'DSC04921.JPG', 'DSC04922.JPG', 'DSC04923.JPG', 'DSC04924.JPG', 'DSC04925.JPG', 'DSC04926.JPG', 'DSC04927.JPG', 'DSC04928.JPG', 'DSC04929.JPG', 'DSC04930.JPG', 'DSC04931.JPG', 'DSC04932.JPG', 'DSC04933.JPG', 'DSC04934.JPG', 'DSC04935.JPG', 'DSC04936.JPG', 'DSC04937.JPG', 'DSC04938.JPG', 'DSC04939.JPG', 'DSC04940.JPG', 'DSC04941.JPG', 'DSC04942.JPG', 'DSC04943.JPG', 'DSC04944.JPG', 'DSC04945.JPG', 'DSC04946.JPG', 'DSC04947.JPG', 'DSC04948.JPG', 'DSC04949.JPG', 'DSC04950.JPG', 'DSC04951.JPG', 'DSC04952.JPG', 'DSC04953.JPG', 'DSC04954.JPG', 'DSC04955.JPG', 'DSC04956.JPG', 'DSC04957.JPG', 'DSC04958.JPG', 'DSC04959.JPG', 'DSC04960.JPG', 'DSC04961.JPG', 'DSC04962.JPG', 'DSC04963.JPG', 'DSC04964.JPG', 'DSC04965.JPG', 'DSC04966.JPG', 'DSC04967.JPG', 'DSC04968.JPG', 'DSC04969.JPG', 'DSC04970.JPG', 'DSC04971.JPG', 'DSC04972.JPG', 'DSC04973.JPG', 'DSC04974.JPG', 'DSC04975.JPG', 'DSC04976.JPG', 'DSC04977.JPG', 'DSC04978.JPG', 'DSC04979.JPG', 'DSC04980.JPG', 'DSC04981.JPG', 'DSC04982.JPG', 'DSC04983.JPG', 'DSC04984.JPG', 'DSC04985.JPG', 'DSC04986.JPG', 'DSC04987.JPG', 'DSC04988.JPG', 'DSC04989.JPG', 'DSC04990.JPG', 'DSC04991.JPG', 'DSC04993.JPG', 'DSC04994.JPG', 'DSC04995.JPG', 'DSC04996.JPG', 'DSC04997.JPG', 'DSC04998.JPG', 'DSC04999.JPG', 'DSC05000.JPG', 'DSC05001.JPG', 'DSC05002.JPG', 'DSC05003.JPG', 'DSC05004.JPG', 'DSC05005.JPG', 'DSC05006.JPG', 'DSC05007.JPG', 'DSC05008.JPG', 'DSC05009.JPG', 'DSC05010.JPG', 'DSC05011.JPG', 'DSC05012.JPG', 'DSC05013.JPG', 'DSC05014.JPG', 'DSC05015.JPG', 'DSC05016.JPG', 'DSC05017.JPG', 'DSC05018.JPG', 'DSC05019.JPG', 'DSC05020.JPG', 'DSC05021.JPG', 'DSC05022.JPG', 'DSC05023.JPG', 'DSC05024.JPG', 'DSC05025.JPG', 'DSC05026.JPG', 'DSC05027.JPG', 'DSC05028.JPG', 'DSC05029.JPG', 'DSC05030.JPG', 'DSC05031.JPG', 'DSC05032.JPG', 'DSC05033.JPG', 'DSC05034.JPG', 'DSC05035.JPG', 'DSC05037.JPG', 'DSC05038.JPG', 'DSC05039.JPG', 'DSC05040.JPG', 'DSC05041.JPG', 'DSC05042.JPG', 'DSC05043.JPG', 'DSC05044.JPG', 'DSC05045.JPG', 'DSC05046.JPG', 'DSC05047.JPG', 'DSC05048.JPG', 'DSC05049.JPG', 'DSC05050.JPG', 'DSC05051.JPG', 'DSC05052.JPG', 'DSC05053.JPG', 'DSC05054.JPG', 'DSC05055.JPG', 'DSC05056.JPG', 'DSC05057.JPG', 'DSC05058.JPG', 'DSC05059.JPG', 'DSC05060.JPG', 'DSC05061.JPG', 'DSC05062.JPG', 'DSC05063.JPG', 'DSC05064.JPG', 'DSC05065.JPG', 'DSC05066.JPG', 'DSC05067.JPG', 'DSC05068.JPG', 'DSC05069.JPG', 'DSC05070.JPG', 'DSC05071.JPG', 'DSC05072.JPG', 'DSC05073.JPG', 'DSC05074.JPG', 'DSC05075.JPG', 'DSC05076.JPG', 'DSC05077.JPG', 'DSC05078.JPG', 'DSC05079.JPG', 'DSC05080.JPG', 'DSC05081.JPG', 'DSC05082.JPG', 'DSC05083.JPG', 'DSC05084.JPG', 'DSC05085.JPG', 'DSC05086.JPG', 'DSC05087.JPG', 'DSC05088.JPG', 'DSC05089.JPG', 'DSC05090.JPG', 'DSC05091.JPG', 'DSC05092.JPG', 'DSC05093.JPG', 'DSC05094.JPG', 'DSC05095.JPG', 'DSC05096.JPG', 'DSC05097.JPG', 'DSC05098.JPG', 'DSC05099.JPG', 'DSC05100.JPG', 'DSC05101.JPG', 'DSC05102.JPG', 'DSC05103.JPG', 'DSC05104.JPG', 'DSC05105.JPG', 'DSC05106.JPG', 'DSC05107.JPG', 'DSC05108.JPG', 'DSC05109.JPG', 'DSC05110.JPG', 'DSC05111.JPG', 'DSC05112.JPG', 'DSC05113.JPG', 'DSC05114.JPG', 'DSC05115.JPG', 'DSC05116.JPG', 'DSC05117.JPG', 'DSC05118.JPG', 'DSC05119.JPG', 'DSC05120.JPG', 'DSC05121.JPG', 'DSC05123.JPG']

NUM_WORKERS = multiprocessing.cpu_count() * 2


def download_file(url):
    r = requests.get(url, stream=True)
    if r.status_code == 200:
        with open('/dev/null', 'wb') as f:
            r.raw.decode_content = True
            shutil.copyfileobj(r.raw, f)
    else:
        raise ValueError("Could not retrieve %s" % (url,))
    print("url: %s, returned: %d" % (url, r.status_code,))


def main():
    if len(sys.argv) < 2 or sys.argv[1] not in ('django', 'tornado'):
        sys.exit('First parameter should be "django" or "tornado"')

    pool = multiprocessing.Pool(NUM_WORKERS)
    server_type = sys.argv[1]
    baseurl = BASE_PHOTO_URL_TORNADO if server_type == 'tornado' else BASE_PHOTO_URL_DJANGO
    results = []
    tstart = time.time()
    for fn in filenames:
        url = "%s/%s" % (baseurl, fn)
        results.append(pool.apply_async(download_file, (url,)))
    pool.close()
    pool.join()
    print("Server type: %d files %s done in %.2f seconds" % (len(results), server_type, time.time() - tstart))


if __name__ == "__main__":
    main()
